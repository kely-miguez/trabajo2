<!doctype html>
<html class="no-js" lang="zxx">
<head>
 <meta charset="utf-8">
 <meta http-equiv="x-ua-compatible" content="ie=edge">
 <title>Registro /Dayross</title>
 <meta name="description" content="">
 <meta name="viewport" content="width=device-width, initial-scale=1">

 <!-- Favicons -->
 <link rel="shortcut icon" href="images/favicon.ico">
 <link rel="apple-touch-icon" href="images/icon.png">

 <!-- Google font (font-family: 'Roboto', sans-serif; Poppins ; Satisfy) -->
 <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i,900" rel="stylesheet">
 <link href="https://fonts.googleapis.com/css?family=Poppins:300,300i,400,400i,500,600,600i,700,700i,800" rel="stylesheet">
 <link href="https://fonts.googleapis.com/css?family=Satisfy" rel="stylesheet">

 <!-- Stylesheets -->
 <link rel="stylesheet" href="css/bootstrap.min.css">
 <link rel="stylesheet" href="css/plugins.css">
   <link rel="stylesheet" href="style.css">
 <link rel="stylesheet" href="css/custom.css">
 <script src="js/vendor/modernizr-3.5.0.min.js"></script>
 </head>
 <body>
   <div class="wrapper" id="wrapper">

     <!-- Header -->
     <header id="wn__header" class="oth-page header__area header__absolute sticky__header">
       <div class="container-fluid">
         <div class="row">
           <div class="col-md-4 col-sm-4 col-7 col-lg-2">
             <div class="logo">
               <a href="index.php">
                 <img src="https://dewey.tailorbrands.com/production/brand_version_mockup_image/318/2342459318_d7484af5-64db-4947-976b-1069df3db2a5.png?cb=1571669948" alt="logo images">
               </a>
             </div>
           </div>
           <div class="col-lg-8 d-none d-lg-block">
             <nav class="mainmenu__nav">
               <ul class="meninmenu d-flex justify-content-start">
                 <li class="drop with--one--item"><a href="index.php">Home</a></li>
                 <li class="drop"><a href="registro.php">Registro</a>
                 <li class="drop"><a href="login.php">Iniciar sesion</a>
                 <li class="drop"><a href="shop-grid.php">Perfil</a>
                 <li class="drop with--one--item"><a href="faq.php">F.A.Q</a>
                 <li><a href="contact.php">Contacto</a></li>
               </ul>
                   </div>
                 </li>
                   </div>
                 </li>
                   </div>
                 </li>

                   <div class="megamenu dropdown">
                     <ul class="item item01">


                       </li>

                     </ul>
                   </div>
                 </li>



                     </ul>
                   </div>
                 </li>

               </ul>
             </nav>
           </div>
           <div class="col-md-8 col-sm-8 col-5 col-lg-2">
             <ul class="header__sidebar__right d-flex justify-content-end align-items-center">
               <li class="shop_search"><a class="search__active" href="#"></a></li>
               <li class="wishlist"><a href="#"></a></li>
               <li class="shopcart"><a class="cartbox_active" href="#"><span class="product_qun"></span></a>
                 <!-- Start Shopping Cart -->
                 <div class="block-minicart minicart__active">
                   <div class="minicart-content-wrapper">
                     <div class="micart__close">
                       <span>close</span>
                     </div>
                     <div class="items-total d-flex justify-content-between">
                       <span>3 items</span>
                       <span>Cart Subtotal</span>
                     </div>
                     <div class="total_amount text-right">
                       <span>$66.00</span>
                     </div>
                     <div class="mini_action checkout">
                       <a class="checkout__btn" href="cart.php">Go to Checkout</a>
                     </div>
                     <div class="single__items">
                       <div class="miniproduct">
                         <div class="item01 d-flex">
                           <div class="thumb">
                             <a href="product-details.php"><img src="images/product/sm-img/1.jpg" alt="product images"></a>
                           </div>
                           <div class="content">
                             <h6><a href="product-details.php">Voyage Yoga Bag</a></h6>
                             <span class="prize">$30.00</span>
                             <div class="product_prize d-flex justify-content-between">
                               <span class="qun">Qty: 01</span>
                               <ul class="d-flex justify-content-end">
                                 <li><a href="#"><i class="zmdi zmdi-settings"></i></a></li>
                                 <li><a href="#"><i class="zmdi zmdi-delete"></i></a></li>
                               </ul>
                             </div>
                           </div>
                         </div>
                         <div class="item01 d-flex mt--20">
                           <div class="thumb">
                             <a href="product-details.php"><img src="images/product/sm-img/3.jpg" alt="product images"></a>
                           </div>
                           <div class="content">
                             <h6><a href="product-details.php">Impulse Duffle</a></h6>
                             <span class="prize">$40.00</span>
                             <div class="product_prize d-flex justify-content-between">
                               <span class="qun">Qty: 03</span>
                               <ul class="d-flex justify-content-end">
                                 <li><a href="#"><i class="zmdi zmdi-settings"></i></a></li>
                                 <li><a href="#"><i class="zmdi zmdi-delete"></i></a></li>
                               </ul>
                             </div>
                           </div>
                         </div>
                         <div class="item01 d-flex mt--20">
                           <div class="thumb">
                             <a href="product-details.php"><img src="images/product/sm-img/2.jpg" alt="product images"></a>
                           </div>
                           <div class="content">
                             <h6><a href="product-details.php">Compete Track Tote</a></h6>
                             <span class="prize">$40.00</span>
                             <div class="product_prize d-flex justify-content-between">
                               <span class="qun">Qty: 03</span>
                               <ul class="d-flex justify-content-end">
                                 <li><a href="#"><i class="zmdi zmdi-settings"></i></a></li>
                                 <li><a href="#"><i class="zmdi zmdi-delete"></i></a></li>
                               </ul>
                             </div>
                           </div>
                         </div>
                       </div>
                     </div>
                     <div class="mini_action cart">
                       <a class="cart__btn" href="cart.php">View and edit cart</a>
                     </div>
                   </div>
                 </div>
                 <!-- End Shopping Cart -->
               </li>
               <li class="setting__bar__icon"><a class="setting__active" href="#"></a>
                 <div class="searchbar__content setting__block">
                   <div class="content-inner">
                     <div class="switcher-currency">
                       <strong class="label switcher-label">
                         <span>Currency</span>
                       </strong>
                       <div class="switcher-options">
                         <div class="switcher-currency-trigger">
                           <span class="currency-trigger">USD - US Dollar</span>
                           <ul class="switcher-dropdown">
                             <li>GBP - British Pound Sterling</li>
                             <li>EUR - Euro</li>
                           </ul>
                         </div>
                       </div>
                     </div>
                     <div class="switcher-currency">
                       <strong class="label switcher-label">
                         <span>Language</span>
                       </strong>

                     </div>
                     <div class="switcher-currency">
                       <strong class="label switcher-label">
                         <span>Select Store</span>
                       </strong>
                       <div class="switcher-options">
                         <div class="switcher-currency-trigger">
                           <span class="currency-trigger">Fashion Store</span>
                           <ul class="switcher-dropdown">
                             <li>Furniture</li>
                             <li>Shoes</li>
                             <li>Speaker Store</li>
                             <li>Furniture</li>
                           </ul>
                         </div>
                       </div>
                     </div>
                     <div class="switcher-currency">
                       <strong class="label switcher-label">
                         <span>My Account</span>
                       </strong>
                       <div class="switcher-options">
                         <div class="switcher-currency-trigger">
                           <div class="setting__menu">
                             <span><a href="#">Compare Product</a></span>
                             <span><a href="#">My Account</a></span>
                             <span><a href="#">My Wishlist</a></span>
                             <span><a href="#">Sign In</a></span>
                             <span><a href="#">Create An Account</a></span>
                           </div>
                         </div>
                       </div>
                     </div>
                   </div>
                 </div>
               </li>
             </ul>
           </div>
         </div>
         <!-- Start Mobile Menu -->
         <div class="row d-none">
           <div class="col-lg-12 d-none">
             <nav class="mobilemenu__nav">
               <ul class="meninmenu">
                 <li><a href="index.php">Home</a></li>
                 <li><a href="#">Pages</a>
                   <ul>
                     <li><a href="about.php">About Page</a></li>
                     <li><a href="portfolio.php">Portfolio</a>
                       <ul>
                         <li><a href="portfolio.php">Portfolio</a></li>
                         <li><a href="portfolio-details.php">Portfolio Details</a></li>
                       </ul>
                     </li>
                     <li><a href="my-account.php">My Account</a></li>
                     <li><a href="cart.php">Cart Page</a></li>
                     <li><a href="checkout.php">Checkout Page</a></li>
                     <li><a href="wishlist.php">Wishlist Page</a></li>
                     <li><a href="error404.php">404 Page</a></li>
                     <li><a href="faq.php">Faq Page</a></li>
                     <li><a href="team.php">Team Page</a></li>
                   </ul>
                 </li>
                 <li><a href="shop-grid.php">Shop</a>
                   <ul>
                     <li><a href="shop-grid.php">Shop Grid</a></li>
                     <li><a href="single-product.php">Single Product</a></li>
                   </ul>
                 </li>
                 <li><a href="blog.php">Blog</a>
                   <ul>
                     <li><a href="blog.php">Blog Page</a></li>
                     <li><a href="blog-details.php">Blog Details</a></li>
                   </ul>
                 </li>
                 <li><a href="registro.php">Registro</a></li>
               </ul>
             </nav>
           </div>
         </div>
         <!-- End Mobile Menu -->
               <div class="mobile-menu d-block d-lg-none">
               </div>
               <!-- Mobile Menu -->
       </div>
     </header>
     <!-- //Header -->
     <!-- Start Search Popup -->
     <div class="box-search-content search_active block-bg close__top">
       <form id="search_mini_form" class="minisearch" action="#">
         <div class="field__search">
           <input type="text" placeholder="Search entire store here...">
           <div class="action">
             <a href="#"><i class="zmdi zmdi-search"></i></a>
           </div>
         </div>
       </form>
       <div class="close__wrap">
         <span>close</span>
       </div>
     </div>
     <!-- End Search Popup -->
         <!-- Start Bradcaump area -->
         <div class="ht__bradcaump__area bg-image--2">
             <div class="container">
                 <div class="row">
                     <div class="col-lg-12">
                         <div class="bradcaump__inner text-center">
                           <h2 class="bradcaump-title">Registro</h2>
                             <nav class="bradcaump-content">
                               <a class="breadcrumb_item" href="index.php">Home</a>
                               <span class="brd-separetor">/</span>
                               <span class="breadcrumb_item active">Registro</span>
                             </nav>
                         </div>
                     </div>
                 </div>
             </div>
         </div>



<?php
session_start();
$registroCorrecto=0;
  $usuario=[
    'nombres' => '',
    'email'=> '',
    'apellido' => '',
    'password' => '',
    'confirmacion' => '',
    'avatar'=>''
  ];

  $errores=[
    'nombres' => '',
    'email'=> '',
    'apellido' => '',
    'password' => '',
    'confirmacion' => '',
    'avatar' => ''
  ];
  $errorEmail='';
 if($_POST){
   if ($_FILES['avatar']['error'] === 0) {
       //pido la extension del archivo
       $ext = pathinfo($_FILES['avatar']['name'], PATHINFO_EXTENSION);

       if ($ext != 'png' && $ext != 'jpg' && $ext != 'jpeg') {
           $errorAvatar = 'archivo de formato invalido';
       } else {
           $usuario['avatar'] = $_POST['email'] . '.' . $ext;
           //voy a mover el archivo del temporal a mi carpeta avatars
           move_uploaded_file($_FILES['avatar']['tmp_name'], 'avatars/' . $usuario['avatar']);
       }
   }
     if($_POST['nombres']!=''){
       $usuario['nombres'] = $_POST['nombres'];
     }
     else{
       $errores['nombres']="El nombre no puede estar vacío";

     }
     if($_POST['apellido']!=''){
       $usuario['apellido'] = $_POST['apellido'];
     }
     else{
       $errores['apellido']="El apellido no puede estar vacío";
     }
     if($_POST['email']!=''){

       $usuario['email'] = $_POST['email'];
       //VER QUE EL EMAIL NO SE ENCUENTRE YA REGISTRADO, SINO ENVIAR OTRO ERROR "EL EMAIL YA SE ENCUENTRA REGISTRADO"

       $archivo=FILE_GET_CONTENTS('usuario.json');
       $usuarios=json_decode($archivo,true);
       foreach($usuarios as $emailRegistrado){
         if($emailRegistrado['email']==$usuario['email']){
           $errores['email']='El email ya se encuentra registrado';

         }
       }

     }
     else {
      $errores['email']="Ingrese un email";
     }
    if($_POST['password']!=''){
      $usuario['password'] = $_POST['password'];
    }
    else {
     $errores["password"]="La contraseña no puede estar vacía";
    }
    if($_POST['confirmacion']!=''){
      $usuario['confirmacion'] = $_POST['confirmacion'];
    }
    else {
      $errores["password"]= "Confirme su contraseña";
    }
    if($_POST['password'] != $_POST['confirmacion']){
      $errores["password"]="Las contraseñas no coinciden";
    }
    if($errores['nombres']==""&&$errores['apellido']==""&&$errores['email']==""&&$errores['password']==""){


     //si salio todo ok  redirecciona y se guarda en un json
     $hash1=password_hash($usuario['password'],PASSWORD_DEFAULT);
     $hash2=password_hash($usuario['confirmacion'],PASSWORD_DEFAULT);
     $usuario['password']=$hash1;
     $usuario['confirmacion']=$hash2;

     //Guardo en json mi usuario, lo codifico en json denuevo y lo subo:

     $usuarios[] = $usuario;
     $registroCorrecto = 1;
     $json=json_encode($usuarios);
     FILE_PUT_CONTENTS('usuario.json',$json);
}
}
     ?>





    <?php //require_once('header.php'); ?>

    <div class="container">
      <h4>Formulario de Registro</h4>

      <form class="" action="registro.php" method="post" enctype="multipart/form-data">
        <div class="error"><?php echo $errores['nombres']; ?></div>
        <input class="controles" type="text" name="nombres" value="<?php echo $usuario['nombres']; ?>" placeholder="Ingrese su nombre">
        <div class="error"><?php echo $errores['apellido']; ?></div>
        <input class="controles" type="text" name="apellido" value="<?php echo $usuario['apellido']; ?>" placeholder="Ingrese su apellido" >
        <div class="error"><?php echo $errores['email']; ?></div>
        <input class="controles" type="email" name="email" value="<?php echo $usuario['email']; ?>" placeholder="Ingrese su correo electronico">
        <div class="error"><?php echo $errores['password']; ?></div>
        <input class="controles" type="password" name="password" value="" placeholder="Ingrese su contraseña">

        <input class="controles" type="password" name="confirmacion" value="" placeholder="Vuelva a ingresar su contraseña">
        <div class="form-group">
          <label for="avatar">Subir avatar</label>
          <input type="file"  id="avatar" name="avatar">
        </div>
        <button class="boton" type="submit" class="btn btn-secondary btn-sm">Registrar</a></button>
        <p>Ya estás registrado? <a class="link" href="login.php">Iniciar sesión</a></a> </p>



      </form>
      <?php
       if($registroCorrecto==1){?>
        <div class="alert alert-success" role="alert">
      <h4 class="alert-heading">REGISTRADO EXITOSAMENTE!</h4>
      <p>Bienvenido <?php echo $usuario['nombres']; ?>, con email <?php echo $usuario['email']; ?> </p>
      <hr>
      <p class="mb-0">Bienvenido a Dayross.</p>
    </div>

    <?php  } ?>

    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>



    <footer id="wn__footer" class="footer__area bg__cat--8 brown--color">
     <div class="footer-static-top">
       <div class="container">
         <div class="row">
           <div class="col-lg-12">
             <div class="footer__widget footer__menu">
               <div class="ft__logo">
                 <a href="index.php">
                     <img src="https://dewey.tailorbrands.com/production/brand_version_mockup_image/318/2342459318_d7484af5-64db-4947-976b-1069df3db2a5.png?cb=1571669948" alt="logo images">
                 </a>
                 <p>There are many variations of passages of Lorem Ipsum available, but the majority have suffered duskam alteration variations of passages</p>
               </div>
               <div class="footer__content">
                 <ul class="social__net social__net--2 d-flex justify-content-center">
                   <li><a href="#"><i class="bi bi-facebook"></i></a></li>
                   <li><a href="#"><i class="bi bi-google"></i></a></li>
                   <li><a href="#"><i class="bi bi-twitter"></i></a></li>
                   <li><a href="#"><i class="bi bi-linkedin"></i></a></li>
                   <li><a href="#"><i class="bi bi-youtube"></i></a></li>
                 </ul>

               </div>
             </div>
           </div>
         </div>
       </div>
     </div>
     <div class="copyright__wrapper">
       <div class="container">
         <div class="row">
           <div class="col-lg-6 col-md-6 col-sm-12">
             <div class="copyright">
               <div class="copy__right__inner text-left">
                 <p>Copyright <i class="fa fa-copyright"></i> <a href="https://freethemescloud.com/">Free themes Cloud.</a> All Rights Reserved</p>
               </div>
             </div>
           </div>

         </div>
       </div>
     </div>
    </footer>
    <!-- //Footer Area -->

    </div>
    <!-- //Main wrapper -->

    <!-- JS Files -->


    </body>
    </html>
